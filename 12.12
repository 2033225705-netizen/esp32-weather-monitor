<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32æ¸©æ¹¿åº¦è¿œç¨‹ç›‘æµ‹ç³»ç»Ÿ</title>
    <style>
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            padding: 25px;
            max-width: 650px;
            margin: 0 auto;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            box-sizing: border-box;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 25px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 16px;
            margin-top: 0;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            font-size: 14px;
            padding: 6px 15px;
            border-radius: 20px;
            background: #e8f5e9;
            color: #2e7d32;
            margin-top: 10px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            background-color: #4caf50;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .sensor-container {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            justify-content: center;
        }
        
        .sensor-card {
            flex: 1;
            min-width: 280px;
            background: white;
            border-radius: 18px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .sensor-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
        }
        
        .card-icon {
            font-size: 42px;
            margin-bottom: 20px;
        }
        
        .sensor-card h2 {
            color: #5a6c7d;
            margin: 0 0 15px 0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .value-display {
            font-size: 3.8em;
            font-weight: 700;
            margin: 15px 0;
            line-height: 1;
        }
        
        #temp-value {
            color: #e74c3c;
            text-shadow: 0 3px 6px rgba(231, 76, 60, 0.15);
        }
        
        #humi-value {
            color: #3498db;
            text-shadow: 0 3px 6px rgba(52, 152, 219, 0.15);
        }
        
        .unit {
            font-size: 0.5em;
            color: #95a5a6;
            margin-left: 5px;
        }
        
        .pin-info {
            font-size: 14px;
            color: #95a5a6;
            background: #f8f9fa;
            padding: 8px 15px;
            border-radius: 12px;
            margin-top: 20px;
            display: inline-block;
        }
        
        .last-update {
            text-align: center;
            margin-top: 35px;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .refresh-btn {
            display: block;
            margin: 30px auto 0;
            padding: 12px 28px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .refresh-btn:hover {
            background: #3d8b40;
            transform: scale(1.05);
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            color: #95a5a6;
            font-size: 13px;
            padding-top: 20px;
            border-top: 1px solid #eaeaea;
        }
        
        @media (max-width: 600px) {
            body { padding: 15px; }
            .sensor-container { flex-direction: column; }
            .sensor-card { min-width: 100%; }
            .value-display { font-size: 3.2em; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸŒ¡ï¸ ESP32 æ¸©æ¹¿åº¦è¿œç¨‹ç›‘æµ‹ç³»ç»Ÿ ğŸ’§</h1>
        <p class="subtitle">å®æ—¶ç›‘æµ‹ç¯å¢ƒæ¸©æ¹¿åº¦æ•°æ® | æ•°æ®æº: Blynk IoTå¹³å°</p >
        <div class="status-indicator">
            <div class="status-dot"></div>
            <span id="status-text">æ­£åœ¨è¿æ¥è®¾å¤‡...</span>
        </div>
    </div>
    
    <div class="sensor-container">
        <div class="sensor-card">
            <div class="card-icon">ğŸ”¥</div>
            <h2>å½“å‰æ¸©åº¦</h2>
            <div class="value-display">
                <span id="temp-value">--</span><span class="unit">â„ƒ</span>
            </div>
            <div class="pin-info">è™šæ‹Ÿå¼•è„š: V1</div>
            <div class="error-message" id="temp-error"></div>
        </div>
        
        <div class="sensor-card">
            <div class="card-icon">ğŸ’§</div>
            <h2>å½“å‰æ¹¿åº¦</h2>
            <div class="value-display">
                <span id="humi-value">--</span><span class="unit">%</span>
            </div>
            <div class="pin-info">è™šæ‹Ÿå¼•è„š: V2</div>
            <div class="error-message" id="humi-error"></div>
        </div>
    </div>
    
    <button class="refresh-btn" id="refreshBtn">ğŸ”„ æ‰‹åŠ¨åˆ·æ–°æ•°æ®</button>
    
    <div class="last-update">
        æœ€åæ›´æ–°: <span id="lastUpdateTime">--</span>
    </div>
    
    <div class="footer">
        <p>ESP32 + Blynk IoT | æ•°æ®æ›´æ–°é—´éš”: 5ç§’ | ç³»ç»Ÿè¿è¡Œä¸­...</p >
    </div>

    <script>
        // ==================== é…ç½®ä¿¡æ¯ ====================
        const CONFIG = {
            AUTH_TOKEN: "9471GZCwWhJW_sqNd6b7oWtEcNjt42aT",  // æ‚¨çš„Blynkè®¤è¯ä»¤ç‰Œ
            TEMP_PIN: "V1",                                   // æ¸©åº¦è™šæ‹Ÿå¼•è„š
            HUMI_PIN: "V2",                                   // æ¹¿åº¦è™šæ‹Ÿå¼•è„š
            UPDATE_INTERVAL: 5000,                            // æ›´æ–°é—´éš”(æ¯«ç§’)
            API_BASE_URL: "https://sgp1.blynk.cloud/external/api"  // Blynk APIåœ°å€
        };
        // =================================================
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(message, isError = false) {
            const statusEl = document.getElementById('status-text');
            const statusDot = document.querySelector('.status-dot');
            
            statusEl.textContent = message;
            
            if (isError) {
                statusDot.style.backgroundColor = '#e74c3c';
                statusEl.parentElement.style.background = '#ffebee';
                statusEl.parentElement.style.color = '#c62828';
            } else {
                statusDot.style.backgroundColor = '#4caf50';
                statusEl.parentElement.style.background = '#e8f5e9';
                statusEl.parentElement.style.color = '#2e7d32';
            }
        }
        
        // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
        function updateTimestamp() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-CN');
            document.getElementById('lastUpdateTime').textContent = timeString;
        }
        
        // è·å–ä¼ æ„Ÿå™¨æ•°æ®
        async function fetchSensorData() {
            try {
                updateStatus("æ­£åœ¨è·å–æ•°æ®...", false);
                
                // å¹¶è¡Œè·å–æ¸©åº¦å’Œæ¹¿åº¦æ•°æ®
                const [tempResponse, humiResponse] = await Promise.all([
                    fetch(`${CONFIG.API_BASE_URL}/get?token=${CONFIG.AUTH_TOKEN}&${CONFIG.TEMP_PIN}`),
                    fetch(`${CONFIG.API_BASE_URL}/get?token=${CONFIG.AUTH_TOKEN}&${CONFIG.HUMI_PIN}`)
                ]);
                
                // æ£€æŸ¥å“åº”çŠ¶æ€
                if (!tempResponse.ok) throw new Error(`æ¸©åº¦æ•°æ®è¯·æ±‚å¤±è´¥: ${tempResponse.status}`);
                if (!humiResponse.ok) throw new Error(`æ¹¿åº¦æ•°æ®è¯·æ±‚å¤±è´¥: ${humiResponse.status}`);
                
                // è·å–å“åº”æ•°æ®
                const tempText = await tempResponse.text();
                const humiText = await humiResponse.text();
                
                // éªŒè¯æ•°æ®æœ‰æ•ˆæ€§
                const tempValue = parseFloat(tempText);
                const humiValue = parseFloat(humiText);
                
                if (isNaN(tempValue) || isNaN(humiValue)) {
                    throw new Error("æ¥æ”¶åˆ°æ— æ•ˆæ•°æ®æ ¼å¼");
                }
                
                // æ›´æ–°æ¸©åº¦æ˜¾ç¤º
                document.getElementById('temp-value').textContent = tempValue.toFixed(1);
                document.getElementById('temp-error').style.display = 'none';
                
                // æ›´æ–°æ¹¿åº¦æ˜¾ç¤º
                document.getElementById('humi-value').textContent = humiValue.toFixed(1);
                document.getElementById('humi-error').style.display = 'none';
                
                // æ›´æ–°çŠ¶æ€å’Œæ—¶é—´æˆ³
                updateStatus("æ•°æ®è·å–æˆåŠŸ âœ“");
                updateTimestamp();
                
                return { temperature: tempValue, humidity: humiValue };
                
            } catch (error) {
                console.error("æ•°æ®è·å–é”™è¯¯:", error);
                
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                updateStatus("æ•°æ®è·å–å¤±è´¥", true);
                
                // æ˜¾ç¤ºå…·ä½“çš„é”™è¯¯ä¿¡æ¯
                if (error.message.includes("æ¸©åº¦")) {
                    document.getElementById('temp-error').textContent = "æ¸©åº¦: " + error.message;
                    document.getElementById('temp-error').style.display = 'block';
                    document.getElementById('temp-value').textContent = "--";
                } else if (error.message.includes("æ¹¿åº¦")) {
                    document.getElementById('humi-error').textContent = "æ¹¿åº¦: " + error.message;
                    document.getElementById('humi-error').style.display = 'block';
                    document.getElementById('humi-value').textContent = "--";
                } else {
                    document.getElementById('temp-error').textContent = error.message;
                    document.getElementById('temp-error').style.display = 'block';
                    document.getElementById('humi-error').textContent = error.message;
                    document.getElementById('humi-error').style.display = 'block';
                }
                
                return null;
            }
        }
        
        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            console.log("æ¸©æ¹¿åº¦ç›‘æµ‹ç³»ç»Ÿåˆå§‹åŒ–...");
            console.log("æ¸©åº¦å¼•è„š:", CONFIG.TEMP_PIN, "| æ¹¿åº¦å¼•è„š:", CONFIG.HUMI_PIN);
            
            // åˆå§‹æ•°æ®è·å–
            fetchSensorData();
            
            // è®¾ç½®å®šæ—¶æ›´æ–°
            setInterval(fetchSensorData, CONFIG.UPDATE_INTERVAL);
            
            // ç»‘å®šæ‰‹åŠ¨åˆ·æ–°æŒ‰é’®
            document.getElementById('refreshBtn').addEventListener('click', function() {
                this.textContent = "ğŸ”„ åˆ·æ–°ä¸­...";
                this.disabled = true;
                
                fetchSensorData().finally(() => {
                    setTimeout(() => {
                        this.textContent = "ğŸ”„ æ‰‹åŠ¨åˆ·æ–°æ•°æ®";
                        this.disabled = false;
                    }, 1000);
                });
            });
            
            // æ·»åŠ å¡ç‰‡ç‚¹å‡»åˆ·æ–°åŠŸèƒ½
            document.querySelectorAll('.sensor-card').forEach(card => {
                card.addEventListener('click', function() {
                    this.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        this.style.transform = '';
                        fetchSensorData();
                    }, 200);
                });
            });
            
            updateStatus("ç³»ç»Ÿå·²å°±ç»ªï¼Œç­‰å¾…æ•°æ®...");
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
